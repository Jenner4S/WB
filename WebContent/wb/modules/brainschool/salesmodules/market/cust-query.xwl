{"hidden":false,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"layout":"absolute","itemId":"editWin","focusControl":"CUST_NAME","editWin":"true","width":"768","height":"568"},"expanded":true,"children":[{"configs":{"itemId":"VER"},"expanded":false,"children":[],"type":"hidden"},{"configs":{"itemId":"ID","x":"600","width":"100","y":"24","height":"22"},"expanded":false,"children":[],"type":"hidden"},{"configs":{"allowBlank":"false","itemId":"CUST_CODE","labelAlign":"right","fieldLabel":"编号","width":"312","x":"8","y":"16","labelWidth":"90","readOnly":"true","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"itemId":"CUST_SEX","labelAlign":"right","fieldLabel":"性别","keyName":"sex","width":"312","x":"8","y":"112","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"CUST_BIRTH","labelAlign":"right","fieldLabel":"出生日期","x":"8","width":"312","y":"144","height":"22"},"expanded":false,"children":[],"type":"date"},{"configs":{"itemId":"CUST_CHANNEL","labelAlign":"right","fieldLabel":"来源渠道","x":"8","width":"312","y":"176","height":"22"},"expanded":false,"children":[{"configs":{"itemId":"pickComp","rootVisible":"false","height":"250"},"expanded":true,"children":[{"configs":{"itemId":"store","fields":"['text', 'CHANNEL_NAME', 'CHANNEL_ID', 'PARENT_CHANNEL', 'ORDER_INDEX']","url":"m?xwl=brainschool/systemmodules/public/get-channel-tree"},"expanded":false,"children":[],"type":"treestore","events":{"load":"Wb.selFirst(app.tree1); //首次加载时选择首个节点","beforeload":"var node = operation.node;\noperation.params.parentChannel = node.isRoot() ? -1 : operation.node.data.CHANNEL_ID;"}}],"type":"tree","events":{"itemclick":"\nif (record.isLeaf()) {\n\n}\n\nvar picker = this.ownerCmp;\n//picker.setValue(Wb.getSection(record.getPath('text'), '/', 2));\npicker.setRawValue(Wb.getSection(record.getPath('text'), '/', 2));\npicker.collapse();"}}],"type":"picker"},{"configs":{"allowBlank":"false","itemId":"CUST_MOBILE","labelAlign":"right","fieldLabel":"手机号码","width":"312","x":"8","y":"208","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"CUST_QQ","labelAlign":"right","fieldLabel":"QQ","width":"312","x":"8","y":"240","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"CUST_NICK","labelAlign":"right","fieldLabel":"昵称","width":"312","x":"8","y":"80","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"CUST_NAME","labelAlign":"right","fieldLabel":"姓名","width":"312","x":"8","y":"48","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"CUST_EMAIL","labelAlign":"right","fieldLabel":"Email","width":"312","x":"8","y":"272","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"CUST_ADDRESS","labelAlign":"right","fieldLabel":"家庭住址","width":"312","x":"8","y":"304","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"itemId":"CUST_INTENTION_SCH","labelAlign":"right","fieldLabel":"意向校区","keyName":"bool","width":"312","x":"8","y":"336","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"CUST_INTENTION_COURSE","labelAlign":"right","fieldLabel":"意向课程","keyName":"bool","width":"312","x":"8","y":"368","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"CUST_INTENTION_TECHER","labelAlign":"right","fieldLabel":"意向教师","keyName":"bool","width":"312","x":"8","y":"400","labelWidth":"90","height":"22"},"expanded":false,"children":[],"type":"combo"},{"configs":{"itemId":"REMARKS","labelAlign":"right","fieldLabel":"备注","width":"728","x":"8","y":"432","labelWidth":"90","height":"70"},"expanded":false,"children":[],"type":"textarea"},{"configs":{"itemId":"linkGrid","editable":"true","x":"336","width":"400","y":"208","title":"联系人列表","height":"216"},"expanded":true,"children":[{"configs":{"itemId":"tbar"},"expanded":true,"children":[{"configs":{"itemId":"addItem","text":"添加","iconCls":"table_add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.addEdit(app.linkGrid);"}},{"configs":{"itemId":"item1","text":"-"},"expanded":true,"children":[],"type":"item"},{"configs":{"itemId":"delItem","text":"删除","iconCls":"table_delete_icon"},"expanded":true,"children":[],"type":"item","events":{"click":"Wb.del(app.linkGrid, {\n  url: 'm?xwl=brainschool/salesmodules/market/linkman/delete',\n  titleField: 'ID'\n});\n"}},{"configs":{"itemId":"item2","text":"-"},"expanded":true,"children":[],"type":"item"},{"configs":{"itemId":"saveItem","text":"保存","iconCls":"save_icon"},"expanded":true,"children":[],"type":"item","events":{"click":"var cust_id = app.ID.getValue();\nif(cust_id && cust_id >0){\n\tif (!Wb.verifyGrid(app.linkGrid)) //验证数据是否合法\n      return;\n    Wb.sync({\n      grid: app.linkGrid,\n      url: 'm?xwl=brainschool/salesmodules/market/linkman/save',\n      message: '正在保存中...',\n      params: {\n      CUST_ID : cust_id\n      },\n      success: function(resp) {\n        app.linkGrid.store.commitChanges(); //如果存在多个store可以设置normalName属性或通过app.grid.store方式找到对象\n        Wb.toast('数据保存成功。');\n      }\n    });\n}else{\n\tWb.warn(\"请先保存客户信息！\");\n}"}}],"type":"toolbar"},{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=brainschool/systemmodules/public/get-linkman-bycustid"},"expanded":true,"children":[],"type":"store"}],"type":"grid"},{"configs":{"layout":"center","itemId":"avatarform","x":"568","width":"168","y":"16","height":"184"},"expanded":true,"children":[{"configs":{"itemId":"file1","allowBlank":"false","buttonText":"选择要上传的头像","buttonOnly":"true","x":"592","width":"164","y":"104","height":"22"},"expanded":false,"children":[],"type":"file","events":{"change":"//文件上传必须使用form控件,form控件可以嵌套在任何容器中，包括panel,window和viewport等。\nif (!Wb.verify(app.avatarform)) //验证值是否合法\n  return;\n//上传数据。此方法采用multipart/form-data编码上传数据，因此后台必须通过request.getAttribute(itemId)获取指定控件数据\nWb.upload({\n  form: app.avatarform, //上传的表单控件，必选项\n  showProgress: true, //显示上传进度条\n  url: 'm?xwl=brainschool/systemmodules/public/img-upload&type=1',\n  //out:[panel1, grid1],以控件列表的方式上传指定控件值\n  //showMask: false,上传过程不显示mask\n  //message: '正在上传中...',\n  //mask: app.avatarform, //mask遮盖对象，未指定默认为全屏，前2秒透明遮盖。\n  params: { //以json对象表达的参数列表\n    foo: 'bar',\n    num: 123,\n    date: new Date()\n  },\n  //上传成功之后的回调方法\n  success: function(form, action, value) {\n    //value为服务器返回的值，action.response.responseText为服务器返回的原始值\n    var avatarPath = Wb.decode(value).filepath;\n    app.avatarimage.setSrc(avatarPath); \n    app.CUST_AVATAR.setValue(avatarPath);\n  }\n});"}}],"type":"form"},{"configs":{"itemId":"panel1","x":"336","width":"232","y":"16","height":"184"},"expanded":false,"children":[],"type":"panel"},{"configs":{"itemId":"avatarimage","x":"336","width":"232","y":"16","height":"184"},"expanded":false,"children":[],"type":"image"},{"configs":{"itemId":"CUST_AVATAR","x":"400","width":"100","y":"24","height":"22"},"expanded":false,"children":[],"type":"hidden"}],"type":"window","events":{"beforeshow":"\nif (app.isEdit) {\n  var avatar = app.selRec.data.CUST_AVATAR;\n  if(avatar){\n    app.avatarimage.setSrc(avatar);\n  }\n  app.linkGrid.getStore().load({params:{CUST_ID:app.selRec.data.ID}});\n}else{\n\tapp.avatarimage.setSrc(\"\");\n  app.linkGrid.getStore().load();\n}\n","ok":"var values = Wb.getValue(app.editWin);\nif (app.isEdit) {\n  //点击修改按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=brainschool/salesmodules/market/cust/update',\n    params: Wb.applyIf(values, Wb.getData(app.selRec, true)), //合并窗口和记录数据作为参数，后者为默认值\n    success: function(resp) {\n      var v = app.VER.getValue();\n      app.VER.setValue(v +1);\n      //把窗口数据更新到选择记录中\n      Wb.update(app.selRec, values);\n      //隐藏对话框，在模块关闭时自动销毁对话框\n      //app.editWin.close();\n      Wb.toast(\"客户信息保存成功！\");\n    }\n  });\n} else {\n  //点击添加按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=brainschool/salesmodules/market/cust/insert',\n    out: app.editWin,\n    params: {\n      \n    },\n    success: function(resp) {\n      //把服务器返回的数据合并窗口数据 添加到表格中\n      Wb.add(app.grid1, Wb.apply(Wb.decode(resp.responseText), values));\n      var cust = Wb.decode(resp.responseText);\n      if(cust){\n        app.ID.setValue(cust.ID);\n        app.CUST_CODE.setValue(cust.CUST_CODE);\n        app.VER.setValue(cust.VER);\n      }\n      //保存成功后不关闭窗口 将app.isEdit = true 表示再次点击时 执行更新操作\n      app.isEdit = true;\n      Wb.toast(\"客户信息保存成功！\");\n    }\n  });\n}\n"}},{"configs":{"itemId":"viewport1"},"expanded":true,"children":[{"configs":{"itemId":"toolbar1","region":"north"},"expanded":true,"children":[{"configs":{"itemId":"resetItem","text":"重置"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.reset(app.queryForm);"}},{"configs":{"itemId":"item5","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"queryItem","text":"查询","iconCls":"seek_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"app.grid1.store.load({\n  out: app.queryForm\n});"}},{"configs":{"itemId":"item1","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"importItem","text":"导入","iconCls":"import_icon"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"item2","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"addItem","text":"新增","iconCls":"add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"app.isEdit = false; //标识是否为添加或修改状态，在editWin的ok事件中用到此属性\napp.editWin.setTitle('新增客户');\napp.editWin.setIconCls('record_add_icon');\napp.editWin.show();\n"}},{"configs":{"itemId":"item3","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"editItem","text":"编辑","iconCls":"record_edit_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"\nvar sels = app.grid1.getSelection();\nif (sels.length != 1) {\n  Wb.warn('请选择 1 条需要修改的记录。');\n  return;\n}\napp.isEdit = true; //标识是否为添加或修改状态，在editWin的ok事件中用到此属性\napp.selRec = sels[0];\n\n\napp.editWin.setTitle('修改 - ' + app.selRec.data.CUST_NAME);\napp.editWin.setIconCls('record_edit_icon');\nWb.setValue(app.editWin, app.selRec.data);\napp.editWin.show();\n"}},{"configs":{"itemId":"item4","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"deleteItem","text":"删除","iconCls":"delete_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"/*\n建议使用此方法：*/\nWb.del(app.grid1, {\n  url: 'm?xwl=brainschool/salesmodules/market/cust/delete',\n  titleField: 'ID'\n});\n\n"}}],"type":"toolbar"},{"configs":{"layout":"@{type: 'vbox',align:'stretch'}","itemId":"container1","defaults":"{\n  flex: 1,\n  margin: 8\n}","region":"center"},"expanded":true,"children":[{"configs":{"itemId":"queryForm","title":"查询条件"},"expanded":true,"children":[{"configs":{"layout":"anchor","itemId":"panel1","defaults":"{\n  labelAlign: 'right',\n  margin: '8 0 0 0',\n  anchor: '-8'\n}","bodyPadding":"2 10 10 10"},"expanded":true,"children":[{"configs":{"layout":"column","border":"false","itemId":"panel11"},"expanded":true,"children":[{"configs":{"tagConfigs":"{   columnWidth: 1 / 4 }","itemId":"channelPicker","fieldLabel":"渠道","selectOnFocus":"true"},"expanded":true,"children":[{"configs":{"itemId":"pickComp","rootVisible":"false","height":"250"},"expanded":true,"children":[{"configs":{"itemId":"store","fields":"['text', 'CHANNEL_NAME', 'CHANNEL_ID', 'PARENT_CHANNEL', 'ORDER_INDEX']","url":"m?xwl=brainschool/systemmodules/public/get-channel-tree"},"expanded":false,"children":[],"type":"treestore","events":{"load":"Wb.selFirst(app.tree1); //首次加载时选择首个节点","beforeload":"var node = operation.node;\noperation.params.parentChannel = node.isRoot() ? -1 : operation.node.data.CHANNEL_ID;"}}],"type":"tree","events":{"itemclick":"\nif (record.isLeaf()) {\n\n}\n\nvar picker = this.ownerCmp;\n//picker.setValue(Wb.getSection(record.getPath('text'), '/', 2));\npicker.setRawValue(Wb.getSection(record.getPath('text'), '/', 2));\npicker.collapse();"}}],"type":"picker"},{"configs":{"tagConfigs":"{   columnWidth: 1 / 4 }","itemId":"CUST_NAME","fieldLabel":"客户姓名"},"expanded":false,"children":[],"type":"text"},{"configs":{"tagConfigs":"{   columnWidth: 1 / 4 }","itemId":"CUST_MOBILE","fieldLabel":"手机号码"},"expanded":false,"children":[],"type":"text"}],"type":"panel"}],"type":"panel"}],"type":"form"},{"configs":{"itemId":"grid1","title":"查询结果","height":"500"},"expanded":true,"children":[{"configs":{"itemId":"store","normalName":"custStore","autoLoad":"true","url":"m?xwl=brainschool/salesmodules/market/cust/select"},"expanded":false,"children":[],"type":"store"}],"type":"grid","events":{"itemdblclick":"app.editItem.fireEvent('click');"}}],"type":"container"}],"type":"viewport"}],"type":"module","events":{"initialize":"var isEdit = false;"}}],"roles":{"default":1},"title":"客户查询","iconCls":"table_icon","inframe":false,"pageLink":""}