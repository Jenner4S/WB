{"hidden":false,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"layout":"border","itemId":"applyWin","focusControl":"TITLE","resizable":"true","editWin":"true","width":"600","title":"报销申请","height":"400","maximizable":"true"},"expanded":true,"children":[{"configs":{"layout":"hbox","itemId":"container1","margin":"8 8 0 8","region":"north"},"expanded":true,"children":[{"configs":{"itemId":"label1","text":"标题："},"expanded":false,"children":[],"type":"label"},{"configs":{"tagConfigs":"/** TITLE为流程支持的关键属性，因此使用大写 **/","allowBlank":"false","itemId":"TITLE","flex":"1"},"expanded":false,"children":[],"type":"text"}],"type":"container"},{"configs":{"layout":"hbox","itemId":"container11","margin":"8 8 0 8","region":"north"},"expanded":true,"children":[{"configs":{"itemId":"label1","text":"备注："},"expanded":false,"children":[],"type":"label"},{"configs":{"allowBlank":"false","itemId":"memo","flex":"1"},"expanded":false,"children":[],"type":"text"}],"type":"container"},{"configs":{"layout":"fit","itemId":"fieldset1","padding":"8","margin":"8","region":"center","title":"报销费用项目明细"},"expanded":true,"children":[{"configs":{"submitSelect":"false","itemId":"applyGrid","editable":"true","pagingBar":"false","multiSelect":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","normalName":"applyStore","pageSize":"-1","fields":"['name', 'fee', 'remark']"},"expanded":false,"children":[],"type":"store"},{"configs":{"itemId":"tbar"},"expanded":true,"children":[{"configs":{"itemId":"newBtn","tooltip":"添加新的记录","text":"添加","iconCls":"record_add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.addEdit(app.applyGrid);"}},{"configs":{"itemId":"delBtn","tooltip":"删除选择的记录","text":"删除","iconCls":"record_delete_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.remove(app.applyGrid);"}}],"type":"toolbar"},{"configs":{"itemId":"columns"},"expanded":true,"children":[{"configs":{"itemId":"rowCol","xtype":"rownumberer"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"nameCol","dataIndex":"name","flex":"1","text":"项目名称"},"expanded":true,"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"feeCol","dataIndex":"fee","text":"金额"},"expanded":true,"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"expanded":false,"children":[],"type":"number"}],"type":"column"},{"configs":{"itemId":"remarkCol","dataIndex":"remark","text":"备注"},"expanded":true,"children":[{"configs":{"itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"}],"type":"array"}],"type":"grid"}],"type":"fieldset"}],"type":"window","events":{"ok":"if (app.applyStore.getCount() === 0) {\n  Wb.warn('报销费用项目明细不能为空。');\n  return;\n}\nif (Wb.verifyGrid(app.applyGrid)) {\n  if (app.isEdit) {\n    Wb.request({\n      url: 'm?xwl=examples/utilities/workflow/fee-apply/update-apply',\n      params: Wb.apply({}, Wb.getValue(app.applyWin), app.selRec.data),\n      success: function(resp) {\n        Wb.update(app.selRec, Wb.decode(resp.responseText));\n        app.applyWin.close();\n      }\n    });\n  } else {\n    Wb.request({\n      url: 'm?xwl=examples/utilities/workflow/fee-apply/create-apply',\n      out: app.applyWin,\n      success: function(resp) {\n        Wb.add(app.grid1, Wb.decode(resp.responseText), 'first');\n        app.applyWin.close();\n      }\n    });\n  }\n}"}},{"configs":{"itemId":"window1"},"expanded":false,"children":[],"type":"window"},{"configs":{"layout":"border","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"itemId":"toolbar1","region":"north"},"expanded":true,"children":[{"configs":{"itemId":"newBtn","tooltip":"添加新的申请","text":"添加","iconCls":"record_add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"app.applyWin.setTitle('添加新的申请');\napp.applyWin.setIconCls('record_add_icon');\napp.applyStore.removeAll();\napp.applyStore.commitChanges();\napp.applyWin.show();\napp.isEdit = false;"}},{"configs":{"itemId":"editBtn","tooltip":"修改选择的记录","text":"修改","iconCls":"record_edit_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"var sels = app.grid1.getSelection();\nif (sels.length != 1) {\n  Wb.warn('请选择 1 条需要修改的记录。');\n  return;\n}\napp.selRec = sels[0];\napp.applyWin.setTitle('修改 - ' + app.selRec.data.TITLE);\napp.applyWin.setIconCls('record_edit_icon');\nWb.request({\n  url: 'm?xwl=examples/utilities/workflow/fee-apply/select-items',\n  params: app.selRec.data,\n  success: function(resp) {\n    Wb.setValue(app.applyWin, Wb.decode(resp.responseText));\n    app.applyWin.show();\n    app.isEdit = true;\n  }\n});"}},{"configs":{"itemId":"delBtn","tooltip":"删除选择的记录","text":"删除","iconCls":"record_delete_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"var sels = app.grid1.getSelection();\nWb.confirmDo(sels, function() {\n  Wb.request({\n    url: 'm?xwl=examples/utilities/workflow/fee-apply/delete-apply',\n    params: {\n      destroy: Wb.getData(sels, true)\n    },\n    success: function() {\n      Wb.remove(app.grid1, sels);\n    }\n  });\n}, 'TITLE');"}},{"configs":{"itemId":"item1","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"viewBtn","tooltip":"查看当前申请的审批意见","text":"查看审批意见","iconCls":"property_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"var rec = app.grid1.getSelection()[0];\nif (rec)\n  Wb.request({\n    url: 'm?xwl=examples/utilities/workflow/fee-apply/select-items',\n    params: rec.data,\n    success: function(resp) {\n      Wb.viewText('查看审批意见', Wb.decode(resp.responseText).comment);\n    }\n  });\nelse\n  Wb.warn('请选择一条记录。');"}}],"type":"toolbar"},{"configs":{"itemId":"grid1","region":"center","loadColumns":"none","multiSelect":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","remoteSort":"true","autoLoad":"true","sorters":"{property:'MODIFY_DATE',direction:'DESC'}","url":"m?xwl=examples/utilities/workflow/fee-apply/select-list"},"expanded":false,"children":[],"type":"store","events":{"load":"if (!store.colsLoaded) {\n  var col = Wb.getColumn(store, 'MODIFY_DATE');\n  col.renderer = function(value, meta, record) {\n    var icon, status = record.get('STATUS');\n    switch (status) {\n      case '审批中':\n        icon = 'start_icon';\n        break;\n      case '拒绝':\n        icon = 'cancel_icon';\n        break;\n      case '完成':\n        icon = 'ok_icon';\n        break;\n    }\n    return Wb.getIcon(icon, status) + Wb.dateToText(value);\n  };\n  Wb.loadColumns(store);\n  store.colsLoaded = true;\n}"}}],"type":"grid","events":{"itemdblclick":"app.editBtn.fireEvent('click');"}}],"type":"viewport"}],"type":"module"}],"roles":{"demo":1},"title":"费用报销","iconCls":"","inframe":false,"pageLink":""}