{"hidden":false,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"layout":"absolute","itemId":"editWin","focusControl":"REGION_NAME","editWin":"true","width":"416","defaultFocus":"REGION_NAME","height":"224"},"expanded":true,"children":[{"configs":{"itemId":"parentCode","x":"8","width":"100","y":"8","height":"22"},"expanded":false,"children":[],"type":"hidden"},{"configs":{"itemId":"regionCode","labelAlign":"right","fieldLabel":"地区代码","x":"0","width":"376","y":"24","height":"22"},"expanded":false,"children":[],"type":"number"},{"configs":{"itemId":"parentCodeComp","labelAlign":"right","fieldLabel":"上级地区","width":"376","x":"0","y":"64","height":"22"},"expanded":false,"children":[{"configs":{"itemId":"pickComp","rootVisible":"false","height":"250"},"expanded":true,"children":[{"configs":{"itemId":"store","autoLoad":"true","fields":"['text','regionCode','fullName','parentCode']","url":"m?xwl=admin/region/select"},"expanded":false,"children":[],"type":"treestore","events":{"beforeload":"operation.params.regionCode = operation.node.data.regionCode;"}}],"type":"tree","events":{"itemclick":"var picker = this.ownerCmp;\npicker.setValue(Wb.getSection(record.getPath('text'), '/', 2));\npicker.collapse();\n"}}],"type":"picker"},{"configs":{"allowBlank":"false","itemId":"regionName","labelAlign":"right","fieldLabel":"* 地区简称","width":"376","x":"0","y":"96","height":"22"},"expanded":false,"children":[],"type":"text"},{"configs":{"allowBlank":"false","itemId":"fullName","labelAlign":"right","fieldLabel":"* 地区名称","width":"376","x":"0","y":"128","height":"22"},"expanded":false,"children":[],"type":"text"}],"type":"window","events":{"ok":"var values = Wb.getValue(app.editWin);\nif (app.isEdit) {\n  Wb.request({\n    url: 'm?xwl=admin/region/update',\n    params: Wb.applyIf(values, Wb.getData(app.selNode, true)),\n    success: function() {\n      values.text = values.fullName;\n      Wb.update(app.selNode, values);\n      app.editWin.close();\n    }\n  });\n} else {\n  Wb.request({\n    url: 'm?xwl=admin/region/insert',\n    out: app.editWin,\n    params: {\n      parentCode: app.selNode.data.parentCode,\n      regionType: app.selNode.lastChild ? app.selNode.lastChild.data.regionType + 1 : 1\n    },\n    success: function(resp) {\n      app.selNode.expand();\n      app.selNode.appendChild(Wb.apply({\n        iconCls: 'db_field_icon',\n        text: values.fullName,\n        children: []\n      }, Wb.decode(resp.responseText))).commit();\n      app.editWin.close();\n    }\n  });\n}"}},{"configs":{"layout":"border","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"itemId":"toolbar1","region":"north"},"expanded":true,"children":[{"configs":{"itemId":"newBtn","tooltip":"在当前节点下添加记录","text":"添加","iconCls":"record_add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"\nif (!app.selNode) {\n  Wb.warn('请选择 1 个类别。');\n  return;\n}\napp.isEdit = false;\n\napp.editWin.setTitle('添加 - ' + app.selNode.data.text);\napp.editWin.setIconCls('record_add_icon');\napp.editWin.show();\n\n\napp.parentCodeComp.setValue(Wb.getSection(app.selNode.getPath('text'), '/', 2));\napp.parentCode.setValue(app.selNode.data.regionCode);\n\n\n\n"}},{"configs":{"itemId":"editBtn","tooltip":"编辑选择的记录","text":"修改","iconCls":"record_edit_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"if (!app.selNode) {\n  Wb.warn('请选择 1 个渠道。');\n  return;\n}\nif (app.selNode.isRoot()) {\n  Wb.warn('不能对根节点进行修改。');\n  return;\n}\napp.isEdit = true;\napp.editWin.setTitle('修改 - ' + app.selNode.data.text);\napp.editWin.setIconCls('record_edit_icon');\nWb.setValue(app.editWin, app.selNode.data);\napp.parentCodeComp.setValue(Wb.getSection(app.selNode.getPath('text'), '/', 2));\n\napp.editWin.show();\n"}},{"configs":{"itemId":"delBtn","tooltip":"删除选择的记录","text":"删除","iconCls":"record_delete_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"if (app.tree1.selModel.isSelected(app.tree1.getRootNode())) {\n  Wb.warn('不能删除根节点。');\n  return;\n}\nWb.confirm('确定要删除选择的类别及其所属的所有子类型吗？', function() {\n  var typeIds = {};\n  Wb.each(app.tree1.getSelection(), function(node) {\n    node.cascadeBy(function(item) {\n      typeIds[item.data.regionCode] = {\n        regionCode: item.data.regionCode\n      };\n    });\n  });\n  Wb.request({\n    url: 'm?xwl=admin/region/delete',\n    params: {\n      typeIds: Ext.Object.getValues(typeIds)\n    },\n    success: function(resp) {\n      Wb.remove(app.tree1);\n    }\n  });\n});"}},{"configs":{"itemId":"item1","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"refreshBtn","tooltip":"刷新","text":"刷新","iconCls":"refresh_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.reload(app.tree1, null, {\n  field: 'TYPE_ID'\n});"}}],"type":"toolbar"},{"configs":{"itemId":"tree1","root":"{\n  text: '全部',\n  regionCode: '-1',\n  expanded: true\n}","viewConfig":"app.treeViewConfig","region":"center","multiSelect":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","autoLoad":"true","fields":"['text', 'fullName','regionName', 'regionCode', 'parentCode', 'regionType']","url":"m?xwl=admin/region/select"},"expanded":false,"children":[],"type":"treestore","events":{"success":"Wb.selFirst(app.tree1);"}}],"type":"tree","events":{"itemclick":"app.selNode = record;","selectionchange":"app.selNodes = selected;\napp.selNode = selected[0];","beforerender":"\nif(app.selNode){\n  Wb.setValue(tree,Wb.getSection(app.selNode.getPath('text'), '/', 2));\n}\n","itemdblclick":"app.editBtn.fireEvent('click');"}}],"type":"viewport","events":{"afterrender":"app.navKey = new Ext.KeyNav({\n  viewport: app.viewport1,\n  E: {\n    ctrl: true,\n    fn: function() {\n      app.newBtn.fireEvent('click');\n    }\n  }\n});"}}],"type":"module"}],"roles":{"demo":1},"title":"城市地区","iconCls":"star_icon","inframe":false,"pageLink":""}