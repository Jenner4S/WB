{"hidden":false,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"itemId":"filterToolbar"},"expanded":true,"children":[{"configs":{"itemId":"searchCombo","onTriggerClick":"this.collapse();\napp.grid2.store.load({\n  out: app.filterToolbar,\n  currId:app.grid1.getSelection()[0].data.id\n});","emptyText":"FILTER CONDITION","triggerCls":"x-form-search-trigger","width":"250","displayField":"FIN_P_N","enterKeyTriggerClick":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=my/sales/product/product-search"},"expanded":false,"children":[],"type":"store"}],"type":"combo","events":{"select":"Ext.callback(combo.onTriggerClick, combo);"}}],"type":"toolbar"},{"configs":{"layout":"fit","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"itemId":"grid1","editable":"true","region":"center","height":"500"},"expanded":true,"children":[{"configs":{"itemId":"tbar"},"expanded":true,"children":[{"configs":{"itemId":"newBtn","tooltip":"添加新的记录","text":"添加","iconCls":"record_add_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"Wb.addEdit(app.grid1);"}},{"configs":{"itemId":"delBtn","tooltip":"删除选择的记录","text":"删除","iconCls":"record_delete_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"/*\n建议使用此方法：*/\nWb.del(app.grid1, {\n  url: 'm?xwl=my/base/product/delete1',\n  titleField: 'id'\n});\n\n"}},{"configs":{"itemId":"item1","text":"-"},"expanded":false,"children":[],"type":"item"},{"configs":{"itemId":"saveBtn","tooltip":"保存所有的更改","text":"保存","iconCls":"save_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"if (!Wb.verifyGrid(app.grid1)) //验证数据是否合法\n  return;\nWb.sync({\n  grid: app.grid1,\n  url: 'm?xwl=my/base/product/save',\n  message: '正在保存中...',\n  success: function(resp) {\n    app.store.commitChanges(); //如果存在多个store可以设置normalName属性或通过app.grid.store方式找到对象\n    Wb.toast('数据保存成功。');\n  }\n});"}},{"configs":{"itemId":"assemblyBtn","tooltip":"组装零件","text":"组装","iconCls":"select_all_icon"},"expanded":false,"children":[],"type":"item","events":{"click":"//使用下面方法用于演示完整的步骤\nvar recs = app.grid1.getSelection();\nif (!recs.length) {\n  Wb.warn('请选择一条记录。');\n  return;\n}\nvar d = recs[0].data;\nif(d.typ && d.typ == '组装件'){\n  app.win.show();\n}else{\n  Wb.warn('记录 [类型] 不匹配！');\n  return;\n}\n\n"}}],"type":"toolbar"},{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=my/base/product/select"},"expanded":false,"children":[],"type":"store"},{"configs":{"itemId":"columns"},"expanded":true,"children":[{"configs":{"itemId":"rowNumCol","xtype":"rownumberer"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"IDCol","hidden":"true","dataIndex":"id"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"nameCol","hidden":"true","dataIndex":"name","width":"150","text":"名称"},"expanded":false,"children":[{"configs":{"allowBlank":"true","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"FIN_P_NCol","dataIndex":"FIN_P_N","width":"100","text":"零件号"},"expanded":false,"children":[{"configs":{"allowBlank":"false","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"SUB_FIN_P_NCol","dataIndex":"SUB_FIN_P_N","width":"100","text":"子零件"},"expanded":true,"children":[{"configs":{"allowBlank":"true","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"SUB_FIN_P_N_IDSCol","hidden":"true","dataIndex":"SUB_FIN_P_N_IDS","width":"100","text":"子零件号ID"},"expanded":true,"children":[{"configs":{"allowBlank":"true","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"FIN_P_N_REVCol","dataIndex":"FIN_P_N_REV","width":"100","text":"零件版本"},"expanded":true,"children":[{"configs":{"allowBlank":"true","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"RAW_P_NCol","dataIndex":"RAW_P_N","width":"100","text":"毛坯号"},"expanded":true,"children":[{"configs":{"allowBlank":"true","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"RAW_P_N_REVCol","dataIndex":"RAW_P_N_REV","width":"100","text":"毛坯版本"},"expanded":true,"children":[{"configs":{"allowBlank":"true","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"FIN_DWGCol","dataIndex":"FIN_DWG","width":"100","text":"成品图纸"},"expanded":true,"children":[{"configs":{"allowBlank":"true","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"FIN_DWG_REVCol","dataIndex":"FIN_DWG_REV","width":"100","text":"图纸版本"},"expanded":true,"children":[{"configs":{"allowBlank":"true","itemId":"editor"},"expanded":false,"children":[],"type":"text"}],"type":"column"},{"configs":{"itemId":"typCol","dataIndex":"typ","width":"80","text":"类型"},"expanded":true,"children":[{"configs":{"allowBlank":"false","itemId":"editor","keyName":"product_type","displayField":"V","valueField":"V"},"expanded":false,"children":[],"type":"combo"}],"type":"column"},{"configs":{"itemId":"remarkCol","dataIndex":"ext1","flex":"1","text":"产品描述一"},"expanded":true,"children":[{"configs":{"itemId":"editor","allowBlank":"false","height":"80"},"expanded":false,"children":[],"type":"textarea"}],"type":"column"},{"configs":{"itemId":"remarkCol1","dataIndex":"ext2","flex":"1","text":"产品描述二"},"expanded":false,"children":[{"configs":{"itemId":"editor","height":"80"},"expanded":false,"children":[],"type":"textarea"}],"type":"column"},{"configs":{"itemId":"remarkCol2","dataIndex":"ext3","flex":"1","text":"产品描述三"},"expanded":false,"children":[{"configs":{"itemId":"editor","height":"80"},"expanded":false,"children":[],"type":"textarea"}],"type":"column"},{"configs":{"itemId":"remarkCol3","dataIndex":"ext4","flex":"1","text":"产品描述四"},"expanded":false,"children":[{"configs":{"itemId":"editor","height":"80"},"expanded":false,"children":[],"type":"textarea"}],"type":"column"}],"type":"array"}],"type":"grid"},{"configs":{"layout":"fit","itemId":"win","dialog":"true","width":"800","title":"零件列表","height":"400"},"expanded":false,"children":[{"configs":{"itemId":"grid2","barExportAllButtons":"false","selType":"checkboxmodel","tbar":"app.filterToolbar","barExportButtons":"false"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=my/base/product/win-product-list"},"expanded":false,"children":[],"type":"store","events":{"beforeload":"var currId;\nif (app.grid1.getSelection()[0].data.id){\n  currId = app.grid1.getSelection()[0].data.id;\n  Wb.apply(operation.params, {\n    currId: currId\n  });\n}\n"}},{"configs":{"itemId":"columns"},"expanded":true,"children":[{"configs":{"itemId":"numCol","xtype":"rownumberer","width":"30"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_P_NCol","dataIndex":"FIN_P_N","flex":"1","text":"零件号"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_P_N_REVCol","dataIndex":"FIN_P_N_REV","flex":"1","text":"版本"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"RAW_P_NCol","dataIndex":"RAW_P_N","flex":"1","text":"毛坯号"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"RAW_P_N_REVCol","dataIndex":"RAW_P_N_REV","flex":"1","text":"毛坯版本"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_DWGCol","dataIndex":"FIN_DWG","flex":"1","text":"成品图纸"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_DWG_REVCol","dataIndex":"FIN_DWG_REV","flex":"1","text":"图纸版本"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"typCol","dataIndex":"typ","width":"50","text":"类型"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext1Col","dataIndex":"ext1","flex":"1","text":"产品描述一"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext2Col","dataIndex":"ext2","flex":"1","text":"产品描述二"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext3Col","dataIndex":"ext3","flex":"1","text":"产品描述三"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext4Col","dataIndex":"ext4","flex":"1","text":"产品描述四"},"expanded":false,"children":[],"type":"column"}],"type":"array"}],"type":"grid"}],"type":"window","events":{"ok":"var recs = app.grid2.getSelection();\nif (recs.length>0) {\n  var selectP = app.grid1.getSelection()[0].data.id;\n   \n  var ids = [],nos=[];\n  for (var i = 0; i < recs.length; i++) {\n    ids.push(recs[i].get('id'));\n    nos.push(recs[i].get('FIN_P_N'));\n  }\n  var postData = {};\n  postData.selectP = selectP;\n  postData.ids = ids.join(',');\n  postData.nos = nos.join(',');\n  \n  //点击修改按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=my/base/product/assemblySave',\n    params: postData, //合并窗口和记录数据作为参数，后者为默认值\n    message: '正在组装中...',\n    success: function(resp) {\n      Wb.toast(\"零件组装保存成功！\");\n      app.grid1.getStore().reload();\n    }\n  });\n}\napp.win.close();"}}],"type":"viewport"}],"type":"module"}],"roles":{"default":1,"manager":1,"user":1,"demo":1},"title":"产品维护","iconCls":"","inframe":false,"pageLink":""}