{"hidden":false,"children":[{"configs":{"itemId":"module"},"expanded":true,"children":[{"configs":{"itemId":"toolbar1"},"expanded":true,"children":[{"configs":{"itemId":"searchCombo","onTriggerClick":"this.collapse();\napp.pickComp.store.load({\n  out: app.toolbar1\n});","emptyText":"FILTER CONDITION","triggerCls":"x-form-search-trigger","fieldLabel":"FILTER","width":"250","displayField":"FIN_P_N","enterKeyTriggerClick":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=my/sales/product/product-search"},"expanded":false,"children":[],"type":"store"}],"type":"combo","events":{"select":"Ext.callback(combo.onTriggerClick, combo);"}}],"type":"toolbar"},{"configs":{"itemId":"toolbar2"},"expanded":true,"children":[{"configs":{"itemId":"searchCombo1","onTriggerClick":"this.collapse();\napp.pickComp.store.load({\n  out: app.toolbar1\n});","emptyText":"FILTER CONDITION","triggerCls":"x-form-search-trigger","fieldLabel":"FILTER","width":"250","displayField":"FIN_P_N","enterKeyTriggerClick":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=my/sales/product/product-search1"},"expanded":false,"children":[],"type":"store"}],"type":"combo","events":{"select":"Ext.callback(combo.onTriggerClick, combo);"}}],"type":"toolbar"},{"configs":{"itemId":"buttons"},"expanded":true,"children":[{"configs":{"itemId":"saveBtn","text":"保存"},"expanded":false,"children":[],"type":"button","events":{"click":"var url = \"\";\n/**/\nif(app.isEdit){\n  url = 'm?xwl=my/sales/offer/update';\n}else{\n  url = 'm?xwl=my/sales/offer/insert';\n  app.QUOTE_NO.setValue(\"QL\"+new Date().getTime());\n}\nvar quoteNo = app.QUOTE_NO.getValue(),values = Wb.getValue(app.form1);\n\nWb.request({\n  url: url, \n  params: values,\n  success: function(resp) {\n    Wb.toast('保存数据成功。');\n  }\n});\n\n\n/*\nif (app.isEdit) {\n  //点击修改按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=my/sales/offer/update',\n    params: Wb.applyIf(values, Wb.getData(app.selRec, true)), //合并窗口和记录数据作为参数，后者为默认值\n    success: function() {\n      //把窗口数据更新到选择记录中\n      Wb.update(app.selRec, values);\n      //隐藏对话框，在模块关闭时自动销毁对话框\n      //app.editWin.close();\n      Wb.toast('更新数据成功。');\n    }\n  });\n} else {\n  //点击添加按钮的处理过程\n  Wb.request({\n    url: 'm?xwl=my/sales/offer/insert',\n    out: app.form1,\n    params: values,\n    success: function(resp) {\n      //把服务器返回的数据合并窗口数据（公司名称等数据）添加到表格中\n      Wb.add(app.form1, Wb.apply(Wb.decode(resp.responseText), values));\n      //隐藏对话框，在模块关闭时自动销毁对话框\n      //app.editWin.close();\n      Wb.toast('保存数据成功。');\n    }\n  });\n}\n*/\n  "}},{"configs":{"itemId":"resetBtn","text":"重置"},"expanded":false,"children":[],"type":"button"}],"type":"array"},{"configs":{"layout":"fit","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"layout":"fit","itemId":"container1","style":"overflow-y: auto;overflow-x: hidden;"},"expanded":true,"children":[{"configs":{"layout":"form","border":"false","tagConfigs":"{\n\tlabelWidth : 120\n}","itemId":"form1","buttons":"app.buttons","buttonAlign":"center","autoScroll":"true"},"expanded":true,"children":[{"configs":{"border":"false","itemId":"rfqInfoPanel"},"expanded":false,"children":[{"configs":{"layout":"form","border":"false","itemId":"fieldset1","title":"<b style=\"font-size:18px\">RFQ INFO<\/b>"},"expanded":true,"children":[{"configs":{"layout":"column","border":"false","itemId":"panel11"},"expanded":false,"children":[{"configs":{"itemId":"ID"},"expanded":false,"children":[],"type":"hidden"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"QUOTE_NO","fieldLabel":"QUOTE NO","width":"200","readOnly":"true"},"expanded":false,"children":[],"type":"text"},{"configs":{"border":"false","tagConfigs":"{   \n  columnWidth: 1 / 4 \n}","itemId":"panel1"},"expanded":false,"children":[],"type":"panel"},{"configs":{"itemId":"CUST_ID"},"expanded":false,"children":[],"type":"hidden"},{"configs":{"tagConfigs":"{   columnWidth: 1 / 4 }","itemId":"CUST","queryMode":"local","fieldLabel":"CUST","displayField":"codeName","queryCaching":"true","valueField":"CODE","anyMatch":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","autoLoad":"true","url":"m?xwl=my/cust/cust-select"},"expanded":false,"children":[],"type":"store"}],"type":"combo","events":{"select":"if(records && records[0]){\n  \tapp[\"CUST_BUYER\"].setValue(records[0].get(\"NAME\"));\n\tapp.CUST_ID.setValue(records[0].get(\"ID\"));\n}\n\n/*\nif(combo.getValue() != null && combo.getValue() != \"\" ){\n  \tvar index = combo.getStore().find(\"CODE\",combo.getValue(),0,false,true,true);\n  \tif(index){\n      \tapp[\"CUST_BUYER\"].setValue(combo.getStore().getAt(index).get(\"NAME\"));\n  \t\tapp.CUST_ID.setValue(records[0].get(\"ID\"));\n    }\n\t\n}else{\n\tapp[\"CUST_BUYER\"].setValue(\"\");\n}*/","change":"/*\nif(records && records[0]){\n  \tapp[\"CUST_BUYER\"].setValue(records[0].get(\"NAME\"));\n\tapp.CUST_ID.setValue(records[0].get(\"ID\"));\n}\n\nif(combo.getValue() != null && combo.getValue() != \"\" ){\n  \tvar index = combo.getStore().find(\"CODE\",combo.getValue(),0,false,true,true);\n  \tif(index){\n      app[\"CUST_BUYER\"].setValue(combo.getStore().getAt(index).get(\"NAME\"));\n      app.CUST_ID.setValue(combo.getStore().getAt(index).get(\"ID\"));\n    }\n\t\n}else{\n\tapp[\"CUST_BUYER\"].setValue(\"\");\n}*/"}},{"configs":{"tagConfigs":"{   \n  columnWidth: 1 / 4 \n}","itemId":"CUST_BUYER","labelAlign":"left","fieldLabel":"CUST/BUYER"},"expanded":false,"children":[],"type":"text"}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel12"},"expanded":false,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"QUOTE_DATE","fieldLabel":"QUOTE DATE","format":"Y/m/d"},"expanded":false,"children":[],"type":"date"},{"configs":{"itemId":"SALES_PERSON_ID"},"expanded":false,"children":[],"type":"hidden"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"SALES_PERSON","bindField":"USER_NAME","fieldLabel":"SALES PERSON","displayField":"USER_NAME"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=my/sales/offer/user-list"},"expanded":false,"children":[],"type":"store","events":{"load":"if(records.length>0){\n\tfor(var i=0;i<records.length;i++){\n    \tif(records[i].get(\"USER_NAME\") == \"admin\"){\n        \tstore.remove(records[i]);\n        }\n    }\n}"}}],"type":"combo","events":{"select":"\nvar uid = records[0].get(\"USER_ID\");\nif(uid){\n  app.SALES_PERSON_ID.setValue(uid);\n}","change":"\n"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"RFQ_REF","labelAlign":"left","fieldLabel":"RFQ REF"},"expanded":false,"children":[],"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"RFQ_DATE","fieldLabel":"RFQ DATE","format":"Y/m/d"},"expanded":false,"children":[],"type":"date"}],"type":"panel"},{"configs":{"layout":"form","border":"false","itemId":"panel13"},"expanded":false,"children":[{"configs":{"itemId":"RFQ_NOTES","fieldLabel":"RFQ NOTES"},"expanded":false,"children":[],"type":"textarea"}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel14"},"expanded":true,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FIN_P_N","fieldLabel":"FIN P/N"},"expanded":true,"children":[{"configs":{"forceFit":"true","itemId":"pickComp","barExportAllButtons":"false","width":"500","tbar":"app.toolbar1","barExportButtons":"false","height":"250"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=my/sales/product/product-list"},"expanded":false,"children":[],"type":"store"},{"configs":{"itemId":"columns"},"expanded":true,"children":[{"configs":{"itemId":"numCol","xtype":"rownumberer","width":"30"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_P_NCol","dataIndex":"FIN_P_N","flex":"1","text":"零件号"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_P_N_REVCol","dataIndex":"FIN_P_N_REV","flex":"1","text":"版本"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"RAW_P_NCol","dataIndex":"RAW_P_N","flex":"1","text":"毛坯号"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"RAW_P_N_REVCol","dataIndex":"RAW_P_N_REV","flex":"1","text":"毛坯版本"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_DWGCol","dataIndex":"FIN_DWG","flex":"1","text":"成品图纸"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_DWG_REVCol","dataIndex":"FIN_DWG_REV","flex":"1","text":"图纸版本"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"typCol","dataIndex":"typ","width":"50","text":"类型"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext1Col","dataIndex":"ext1","flex":"1","text":"产品描述一"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext2Col","dataIndex":"ext2","flex":"1","text":"产品描述二"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext3Col","dataIndex":"ext3","flex":"1","text":"产品描述三"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext4Col","dataIndex":"ext4","flex":"1","text":"产品描述四"},"expanded":false,"children":[],"type":"column"}],"type":"array"}],"type":"grid","events":{"itemclick":"var picker = this.ownerCmp,fin_p_n = record.data.FIN_P_N,obj = record.data;\nif(fin_p_n){\n  picker.setValue(fin_p_n);\n  app.FIN_P_N.setValue(fin_p_n); \n  app.FIN_P_N_REV.setValue(obj.FIN_P_N_REV); \n  \n  //TODO:控制rawCostPanel和assemblyListPanel的显示及隐藏\n  if(obj.typ && obj.typ=='组装件'){\n    app.rawCostPanel.hide();\n  \tapp.assemblyListPanel.show();\n    app.assemblyListGrid.store.load({\n    \tout:app.FIN_P_N\n    });\n    assemblyTotalPrice = app.assemblyListGrid.view.features[0].summaryData.TotalPrice;\n  }else{\n  \tapp.rawCostPanel.show();\n  \tapp.assemblyListPanel.hide();\n    assemblyTotalPrice = 0;\n  }\n  \n  \n\n  //根据零件号查询历史记录\n  Ext.Ajax.request({\n    url: 'm?xwl=my/sales/offer/offer-list-select-by-FIN_P_N',\n    method: \"GET\",\n    async: false,   //ASYNC 是否异步( TRUE 异步 , FALSE 同步)\n    params: {      \n      FIN_P_N:fin_p_n\n    },\n    success: function(resp, opts) {\n       //TODO 在这里给页面元素填充数据\n      var res = Wb.decode(resp.responseText);\n      if(res.rows && res.rows.length >0){\n        obj = res.rows[0];\n      }\n    }, //请求成功的回调函数 \n    failure: function() { alert(\"获取记录请求失败！\"); }  // 请求失败的回调函数\n  });\n  app.FIN_DWG.setValue(obj.FIN_DWG); \n  app.FIN_DWG_REV.setValue(obj.FIN_DWG_REV);\n  app.FIN_PT_EST_WT.setValue(obj.FIN_PT_EST_WT); \n  app.FIN_DWG_REV.setValue(obj.FIN_DWG_REV);\n  app.FIN_P_N_REV.setValue(obj.FIN_P_N_REV); \n  app.QTY.setValue(obj.QTY);\n  app.UOM.setValue(obj.UOM);\n\n  if(obj.PART_LONG_DESC){\n    app.PART_LONG_DESC.setValue(obj.PART_LONG_DESC);\n  }else{\n      var desc1 = obj.ext1,desc2 = obj.ext2,desc3 = obj.ext3,desc4 = obj.ext4,PART_LONG_DESC=\"\";\n      if(desc1){\n        PART_LONG_DESC = desc1;\n      }\n      if(desc2){\n        PART_LONG_DESC = PART_LONG_DESC + \";\" + desc2;\n      }\n      if(desc3){\n        PART_LONG_DESC =  PART_LONG_DESC + \";\" + desc3;\n      }\n      if(desc4){\n        PART_LONG_DESC =  PART_LONG_DESC + \";\" + desc4;\n      }\n\n      app.PART_LONG_DESC.setValue(PART_LONG_DESC);  \n   }\n  picker.collapse();\n}\n","resize":"grid.setWidth(888);"}}],"type":"picker"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FIN_P_N_REV","labelAlign":"left","fieldLabel":"FIN P/N REV"},"expanded":false,"children":[],"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"QTY","allowDecimals":"false","minValue":"0","fieldLabel":"QTY"},"expanded":false,"children":[],"type":"number"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"UOM","fieldLabel":"UOM","keyName":"UOM"},"expanded":false,"children":[],"type":"combo"}],"type":"panel"},{"configs":{"layout":"form","border":"false","itemId":"panel15"},"expanded":true,"children":[{"configs":{"itemId":"PART_LONG_DESC","fieldLabel":"PART  LONG  DESC"},"expanded":false,"children":[],"type":"text"}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel16"},"expanded":false,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FIN_PT_EST_WT","minValue":"0","fieldLabel":"FIN PT EST  WT(KG)"},"expanded":false,"children":[],"type":"number"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FIN_DWG","fieldLabel":"FIN DWG"},"expanded":false,"children":[],"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FIN_DWG_REV","fieldLabel":"FIN DWG REV"},"expanded":false,"children":[],"type":"text"}],"type":"panel"}],"type":"fieldset"}],"type":"panel"},{"configs":{"border":"false","itemId":"hr1","html":"<hr/>"},"expanded":false,"children":[],"type":"panel"},{"configs":{"border":"false","itemId":"rawCostPanel"},"expanded":false,"children":[{"configs":{"layout":"form","border":"false","itemId":"fieldset2","title":"<b style=\"font-size:18px\">RAW COST<\/b>"},"expanded":true,"children":[{"configs":{"layout":"column","border":"false","itemId":"panel21"},"expanded":true,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"RAW_P_N","fieldLabel":"RAW P/N"},"expanded":true,"children":[{"configs":{"forceFit":"true","itemId":"pickComp","barExportAllButtons":"false","width":"500","tbar":"app.toolbar2","barExportButtons":"false","height":"250"},"expanded":true,"children":[{"configs":{"itemId":"store","url":"m?xwl=my/sales/product/product-list1"},"expanded":false,"children":[],"type":"store"},{"configs":{"itemId":"columns"},"expanded":false,"children":[{"configs":{"itemId":"numCol","xtype":"rownumberer","width":"30"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_P_NCol","dataIndex":"FIN_P_N","flex":"1","text":"零件号"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_P_N_REVCol","dataIndex":"FIN_P_N_REV","flex":"1","text":"版本"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"RAW_P_NCol","dataIndex":"RAW_P_N","flex":"1","text":"毛坯号"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"RAW_P_N_REVCol","dataIndex":"RAW_P_N_REV","flex":"1","text":"毛坯版本"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_DWGCol","dataIndex":"FIN_DWG","flex":"1","text":"成品图纸"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_DWG_REVCol","dataIndex":"FIN_DWG_REV","flex":"1","text":"图纸版本"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"typCol","dataIndex":"typ","width":"50","text":"类型"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext1Col","dataIndex":"ext1","flex":"1","text":"产品描述一"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext2Col","dataIndex":"ext2","flex":"1","text":"产品描述二"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext3Col","dataIndex":"ext3","flex":"1","text":"产品描述三"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"ext4Col","dataIndex":"ext4","flex":"1","text":"产品描述四"},"expanded":false,"children":[],"type":"column"}],"type":"array"}],"type":"grid","events":{"itemclick":"var picker = this.ownerCmp,fin_p_n = record.data.FIN_P_N,obj = record.data;\nif(fin_p_n){\n  picker.setValue(fin_p_n);\n  app.RAW_P_N.setValue(fin_p_n); \n  app.RAW_P_N_REV.setValue(obj.FIN_P_N_REV); \n  //根据毛坯的零件号查询RAW COST历史记录\n  Ext.Ajax.request({\n    url: 'm?xwl=my/sales/offer/offer-list-select-by-RAW_P_N',\n    method: \"GET\",\n    async: false,   //ASYNC 是否异步( TRUE 异步 , FALSE 同步)\n    params: {      \n      RAW_P_N:fin_p_n\n    },\n    success: function(resp, opts) {\n       //TODO 在这里给页面元素填充数据\n      var res = Wb.decode(resp.responseText);\n      if(res.rows && res.rows.length >0){\n        obj = res.rows[0];\n        app.RAW_P_N_REV.setValue(obj.RAW_P_N_REV); \n        app.MAT_L_GRADE.setValue(obj.MAT_L_GRADE); \n        app.MAT_L_MYS.setValue(obj.MAT_L_MYS); \n        app.MAT_L_SIZE.setValue(obj.MAT_L_SIZE); \n        app.FORGING_WT.setValue(obj.FORGING_WT); \n        app.FORGING_UNIT_PRICE.setValue(obj.FORGING_UNIT_PRICE); \n        app.FORGING_COST.setValue(obj.FORGING_COST); \n        app.FORGING_SUPPLIER.setValue(obj.FORGING_SUPPLIER); \n        app.HT_WT.setValue(obj.HT_WT); \n        app.HT_UNIT_PRICE.setValue(obj.HT_UNIT_PRICE); \n        app.H_T_COST.setValue(obj.H_T_COST); \n        app.QTC_COST.setValue(obj.QTC_COST); \n        app.TESTING_COST.setValue(obj.TESTING_COST); \n        app.RAW_TPI.setValue(obj.RAW_TPI); \n        app.CERT_COST_3_2.setValue(obj.CERT_COST_3_2); \n        app.TOTAL_RAW_COST.setValue(obj.TOTAL_RAW_COST); \n      }else{\n      \tapp.RAW_P_N_REV.setValue(\"\"); \n        app.MAT_L_GRADE.setValue(\"\"); \n        app.MAT_L_MYS.setValue(\"\"); \n        app.MAT_L_SIZE.setValue(\"\"); \n        app.FORGING_WT.setValue(\"\"); \n        app.FORGING_UNIT_PRICE.setValue(\"\"); \n        app.FORGING_COST.setValue(\"\"); \n        app.FORGING_SUPPLIER.setValue(\"\"); \n        app.HT_WT.setValue(\"\"); \n        app.HT_UNIT_PRICE.setValue(\"\"); \n        app.H_T_COST.setValue(\"\"); \n        app.QTC_COST.setValue(\"\"); \n        app.TESTING_COST.setValue(\"\"); \n        app.RAW_TPI.setValue(\"\"); \n        app.CERT_COST_3_2.setValue(\"\"); \n        app.TOTAL_RAW_COST.setValue(\"\"); \n      }\n    }, //请求成功的回调函数 \n    failure: function() { alert(\"获取记录请求失败！\"); }  // 请求失败的回调函数\n  });\n  if(obj.MAT_L_SPEC_REV){\n    app.MAT_L_SPEC_REV.setValue(obj.MAT_L_SPEC_REV);\n  }else{\n    app.MAT_L_SPEC_REV.setValue(obj.ext3); \n  }\n  picker.collapse();\n}\n","resize":"grid.setWidth(888);"}}],"type":"picker"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"RAW_P_N_REV","fieldLabel":"RAW P/N REV"},"expanded":false,"children":[],"type":"text"}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel22"},"expanded":false,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"MAT_L_SPEC_REV","fieldLabel":"MAT'L SPEC     & REV"},"expanded":false,"children":[],"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"MAT_L_GRADE","fieldLabel":"MAT'L GRADE"},"expanded":false,"children":[],"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"MAT_L_MYS","fieldLabel":"MAT'L  MYS"},"expanded":false,"children":[],"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"MAT_L_SIZE","fieldLabel":"MAT'L SIZE"},"expanded":false,"children":[],"type":"text"}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel23"},"expanded":false,"children":[{"configs":{"tagConfigs":"{columnWidth: 1 / 4}","itemId":"FORGING_WT","fieldLabel":"FORGING    WT(KG)"},"expanded":false,"children":[],"type":"number","events":{"change":"claFORGING();"}},{"configs":{"tagConfigs":"{columnWidth: 1 / 4}","itemId":"FORGING_UNIT_PRICE","fieldLabel":"FORGING UNIT  PRICE(￥/KG)"},"expanded":false,"children":[],"type":"number","events":{"change":"claFORGING();"}},{"configs":{"tagConfigs":"{columnWidth: 1 / 4}","itemId":"FORGING_COST","fieldLabel":"FORGING  COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{columnWidth: 1 / 4}","itemId":"FORGING_WT1","hidden":"true","fieldLabel":"FORGING    WT(KG)"},"expanded":true,"children":[],"type":"text","events":{"change":"claFORGING();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FORGING_UNIT_PRICE1","hidden":"true","fieldLabel":"FORGING UNIT  PRICE(￥/KG)"},"expanded":false,"children":[],"type":"text","events":{"change":"claFORGING();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FORGING_COST1","hidden":"true","fieldLabel":"FORGING  COST(￥)"},"expanded":false,"children":[],"type":"text"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FORGING_SUPPLIER","fieldLabel":"FORGING SUPPLIER"},"expanded":false,"children":[],"type":"text"}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel24"},"expanded":false,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"HT_WT","minValue":"0","fieldLabel":"HT WT(KG)"},"expanded":false,"children":[],"type":"number","events":{"change":"claHT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"HT_UNIT_PRICE","minValue":"0","fieldLabel":"HT UNIT  PRICE(￥/KG)"},"expanded":false,"children":[],"type":"number","events":{"change":"claHT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"H_T_COST","minValue":"0","fieldLabel":"H/T COST(￥)"},"expanded":false,"children":[],"type":"number"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"QTC_COST","minValue":"0","fieldLabel":"QTC COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel25"},"expanded":false,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"TESTING_COST","minValue":"0","fieldLabel":"TESTING  COST（￥）"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"RAW_TPI","minValue":"0","fieldLabel":"RAW TPI(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{ columnWidth: 1 / 4}","itemId":"CERT_COST_3_2","minValue":"0","fieldLabel":"3.2CERT COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{ columnWidth: 1 / 4}","itemId":"TOTAL_RAW_COST","minValue":"0","fieldLabel":"TOTAL RAW COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel26"},"expanded":true,"children":[],"type":"panel"}],"type":"fieldset"}],"type":"panel"},{"configs":{"itemId":"assemblyListPanel","hidden":"true"},"expanded":true,"children":[{"configs":{"border":"false","itemId":"fieldset1","title":"<b style=\"font-size:18px\">ASSEMBLY LIST<\/b>"},"expanded":true,"children":[{"configs":{"itemId":"assemblyListGrid","barPageButton":"false","barExportAllButtons":"false","editable":"true","barExportButtons":"false"},"expanded":true,"children":[{"configs":{"itemId":"features"},"expanded":true,"children":[{"configs":{"itemId":"features","ftype":"summary"},"expanded":false,"children":[],"type":"feature"}],"type":"array"},{"configs":{"itemId":"columns"},"expanded":true,"children":[{"configs":{"itemId":"numCol","xtype":"rownumberer","width":"30"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_P_NCol","dataIndex":"FIN_P_N","flex":"1","text":"P/N"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"FIN_P_N_REVCol","dataIndex":"FIN_P_N_REV","flex":"1","text":"P/N REV"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"QTYCol","dataIndex":"QTY","flex":"1","text":"QTY"},"expanded":true,"children":[{"configs":{"itemId":"editor"},"expanded":false,"children":[],"type":"number","events":{"change":"var record = app.assemblyListGrid.getSelectionModel().getSelection()[0];\n\nvar obj = record.data;\nif(obj){\n  \trecord.set('TotalPrice',newValue*obj.UnitPrice);\n\trecord.commit();\n  \n  claUNIT_COST_EXCL_17_VAT();\n  claUNIT_COST_INCL_17_VAT();\n}\n"}}],"type":"column"},{"configs":{"itemId":"UnitPriceCol","summaryRenderer":"return 'Total Cost ￥：';","dataIndex":"UnitPrice","flex":"1","text":"Unit Price￥"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"TotalPriceCol","summaryRenderer":"assemblyTotalPrice = summaryData.TotalPrice;\nreturn value;","dataIndex":"TotalPrice","flex":"1","summaryType":"sum","text":"Total Price￥"},"expanded":false,"children":[],"type":"column"},{"configs":{"itemId":"NotesCol","dataIndex":"Notes","flex":"1","text":"Notes"},"expanded":false,"children":[],"type":"column"}],"type":"array"},{"configs":{"itemId":"store","url":"m?xwl=my/sales/product/product-offer-list"},"expanded":false,"children":[],"type":"store"}],"type":"grid"}],"type":"fieldset"}],"type":"panel"},{"configs":{"border":"false","itemId":"panel3"},"expanded":false,"children":[{"configs":{"layout":"form","border":"false","itemId":"fieldset3","title":"<b style=\"font-size:18px\">FINAL MACHINING COST<\/b>"},"expanded":true,"children":[{"configs":{"layout":"column","border":"false","itemId":"panel31"},"expanded":true,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"M_C_COST","minValue":"0","fieldLabel":"M/C COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"SPECIAL_M_C_COST","minValue":"0","fieldLabel":"SPECIAL M/C  COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"WELDING_COST","minValue":"0","fieldLabel":"WELDING  COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"WPS_COST","minValue":"0","fieldLabel":"WPS COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel32"},"expanded":true,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"NDE_COST","minValue":"0","fieldLabel":"NDE COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FUNCT_TEST_COST","minValue":"0","fieldLabel":"FUNCT TEST  COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"TPI_COST","minValue":"0","fieldLabel":"TPI COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"COATING_COST","minValue":"0","fieldLabel":"COATING  COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel33"},"expanded":true,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"PKG_COST","minValue":"0","fieldLabel":"PKG COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"FRT_COST","minValue":"0","fieldLabel":"FRT COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_INCL_17_VAT();"}}],"type":"panel"}],"type":"fieldset"}],"type":"panel"},{"configs":{"border":"false","itemId":"hr2","html":"<hr/>"},"expanded":false,"children":[],"type":"panel"},{"configs":{"border":"false","itemId":"panel4"},"expanded":false,"children":[{"configs":{"layout":"form","border":"false","itemId":"fieldset4"},"expanded":true,"children":[{"configs":{"layout":"column","border":"false","itemId":"panel41"},"expanded":true,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"UNIT_COST_INCL_17_VAT","minValue":"0","fieldLabel":"UNIT COST(￥)  INCL 17% VAT"},"expanded":false,"children":[],"type":"number","events":{"change":"claUNIT_COST_EXCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"UNIT_COST_EXCL_17_VAT","minValue":"0","fieldLabel":"UNIT COST(￥)  EXCL 17% VAT"},"expanded":false,"children":[],"type":"number"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"MARGING","minValue":"0","fieldLabel":"MARGING(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claOFFER_INCL_17_VAT();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"SHIPPING_COST","minValue":"0","fieldLabel":"SHIPPING  COST(￥)"},"expanded":false,"children":[],"type":"number","events":{"change":"claOFFER_INCL_17_VAT();"}}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel42"},"expanded":true,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"OFFER_INCL_17_VAT","minValue":"0","fieldLabel":"OFFER(￥)  INCL 17% VAT"},"expanded":true,"children":[],"type":"number"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"OFFER_EXCL_17_VAT","minValue":"0","fieldLabel":"OFFER(￥)  EXCL 17% VAT"},"expanded":true,"children":[],"type":"number"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"EXCHANGE_RATE","labelAlign":"left","fieldLabel":"EXCHANGE  RATE"},"expanded":false,"children":[],"type":"text","events":{"change":"claOFFER();"}},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"INCOTERMS","minValue":"0","fieldLabel":"INCOTERMS"},"expanded":false,"children":[],"type":"number","events":{"change":"claOFFER();"}}],"type":"panel"},{"configs":{"layout":"column","border":"false","itemId":"panel43"},"expanded":true,"children":[{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"OFFER","minValue":"0","fieldLabel":"OFFER($)"},"expanded":false,"children":[],"type":"number"},{"configs":{"tagConfigs":"{\n  columnWidth: 1 / 4\n}","itemId":"LEAD_TIME","labelAlign":"left","fieldLabel":"LEAD TIME (WEEKS)"},"expanded":false,"children":[],"type":"text"}],"type":"panel"},{"configs":{"layout":"form","border":"false","itemId":"panel44"},"expanded":true,"children":[{"configs":{"itemId":"OFFER_NOTES","fieldLabel":"OFFER  NOTES"},"expanded":false,"children":[],"type":"textarea"}],"type":"panel"}],"type":"fieldset"}],"type":"panel"}],"type":"form"}],"type":"container"},{"configs":{"layout":"fit","itemId":"typeWin","title":"请搜素"},"expanded":true,"children":[{"configs":{"itemId":"grid1"},"expanded":false,"children":[],"type":"grid"}],"type":"window"}],"type":"viewport"}],"type":"module","events":{"finalize":"var rid = '{#id#}';\n//如果参数 rid 有效，查询 rid 的数据\nif(rid){\n\tWb.request({\n      url: 'm?xwl=my/sales/offer/offer-select-by-ID',\n      params : {\n        id : rid\n      },\n      success: function(resp) {\n        var obj = Ext.JSON.decode(resp.responseText);\n        console.log(obj);\n        if(obj != null){\n          Wb.setValue(app.form1, obj);\n          /*\n          Wb.each(obj,function(k,v){\n          \t//console.log(k+\":\"+v);\n            var ele = app[k];\n            //console.log(ele);\n            if(ele){\n            \tele.setValue(v);\n            }\n          });\n          */\n        }\n      }\n    });\n  \tapp.isEdit = true;\n}","initialize":"app.isEdit = false;\nvar assemblyTotalPrice=0;\n/**\n\n*/\nfunction claUNIT_COST_INCL_17_VAT(){\n  \n  var QTC_COST = app.QTC_COST.getValue();\n  var TESTING_COST = app.TESTING_COST.getValue();\n  var TOTAL_RAW_COST = app.TOTAL_RAW_COST.getValue();\n  \n  \n  var RAW_TPI = app.RAW_TPI.getValue();\n  var CERT_COST_3_2 = app.CERT_COST_3_2.getValue();\n  var M_C_COST = app.M_C_COST.getValue();\n  var SPECIAL_M_C_COST = app.SPECIAL_M_C_COST.getValue();\n  var WELDING_COST = app.WELDING_COST.getValue();\n  var WPS_COST = app.WPS_COST.getValue();\n  var NDE_COST = app.NDE_COST.getValue();\n  var FUNCT_TEST_COST = app.FUNCT_TEST_COST.getValue();\n  var TPI_COST = app.TPI_COST.getValue();\n  var COATING_COST = app.COATING_COST.getValue();\n  var PKG_COST = app.PKG_COST.getValue();\n  var FRT_COST = app.FRT_COST.getValue();\n  \n  var H_T_COST = app.H_T_COST.getValue();\n  var FORGING_COST = app.FORGING_COST.getValue();\n  \n  var ret=0;\n  ret=QTC_COST+TESTING_COST+TOTAL_RAW_COST+RAW_TPI+CERT_COST_3_2+M_C_COST+SPECIAL_M_C_COST+WELDING_COST+WPS_COST+NDE_COST+FUNCT_TEST_COST+TPI_COST+COATING_COST+PKG_COST+FRT_COST+H_T_COST+FORGING_COST;\n  \n  if(assemblyTotalPrice){\n    ret += assemblyTotalPrice*1.17;\n  }\n  app.UNIT_COST_INCL_17_VAT.setValue(ret);\n  \n}\nfunction claUNIT_COST_EXCL_17_VAT(){\n\tvar UNIT_COST_INCL_17_VAT = app.UNIT_COST_INCL_17_VAT.getValue();\n  \tif(!UNIT_COST_INCL_17_VAT){\n    \tUNIT_COST_INCL_17_VAT = 0.0;\n    }\n  \tvar ret=0;\n  \tret = UNIT_COST_INCL_17_VAT/1.17;\n  \tif(!ret){\n    \tret += assemblyTotalPrice;\n    }\n \tapp.UNIT_COST_EXCL_17_VAT.setValue(ret);\n}\n\nfunction claOFFER_INCL_17_VAT(){\n  var SHIPPING_COST = app.SHIPPING_COST.getValue();\n  var UNIT_COST_INCL_17_VAT = app.UNIT_COST_INCL_17_VAT.getValue();\n  var MARGING = app.MARGING.getValue();\n  if(!SHIPPING_COST){\n    SHIPPING_COST = 0.0;\n  }\n  if(!UNIT_COST_INCL_17_VAT){\n    UNIT_COST_INCL_17_VAT = 0.0;\n  }\n  if(!MARGING){\n    MARGING = 0.0;\n  }\n  var totalNum = SHIPPING_COST+UNIT_COST_INCL_17_VAT+MARGING;\n  app.OFFER_INCL_17_VAT.setValue(totalNum);\n  app.OFFER_EXCL_17_VAT.setValue(totalNum*0.17);\n}\nfunction claOFFER(){\n  var OFFER_EXCL_17_VAT = app.OFFER_EXCL_17_VAT.getValue();\n  var EXCHANGE_RATE = app.EXCHANGE_RATE.getValue();\n  if(!OFFER_EXCL_17_VAT){\n    SHIPPING_COST = 0.0;\n  }if(!EXCHANGE_RATE){\n    EXCHANGE_RATE = 0.0;\n  }\n  app.OFFER.setValue(OFFER_EXCL_17_VAT/EXCHANGE_RATE);\n}\n/**\n计算FORGING\nFORGING COST(￥) = FORGING WT(KG)*FORGING UNIT PRICE(￥/KG)\n*/\n\nfunction claFORGING(){\n  var FORGING_WT = app.FORGING_WT.getValue();\n  var FORGING_UNIT_PRICE = app.FORGING_UNIT_PRICE.getValue();\n  if(!FORGING_WT){\n    FORGING_WT = 0.0;\n  }if(!FORGING_UNIT_PRICE){\n    FORGING_UNIT_PRICE = 0.0;\n  }\n  app.FORGING_COST.setValue(FORGING_WT*FORGING_UNIT_PRICE);\n}\n/**\n计算H/T COST（￥）\nH/T COST（￥）= HT WT(KG) * HT UNIT PRICE(￥/KG)\n*/\nfunction claHT(){\n  var HT_WT = app.HT_WT.getValue();\n  var HT_UNIT_PRICE = app.HT_UNIT_PRICE.getValue();\n  if(!HT_WT){\n    HT_WT = 0.0;\n  }if(!HT_UNIT_PRICE){\n    HT_UNIT_PRICE = 0.0;\n  }\n  app.H_T_COST.setValue(HT_WT*HT_UNIT_PRICE);\n}"}}],"roles":{"default":1,"manager":1,"user":1},"title":"offer_add","iconCls":"record_add_icon","inframe":true,"pageLink":""}